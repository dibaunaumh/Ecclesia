{% extends 'admin/base_site.html' %}
{% load i18n %}
{% block breadcrumbs %}<div class="breadcrumbs"><a href="/">{% trans 'Home' %}</a> &rsaquo; {{ group.group.name }}{% trans "'s Home" %}</div>{% endblock %}
{% block userlinks %}<a href="/admin/password_change/">{% trans 'Change password' %}</a> / <a href="/admin/logout/">{% trans 'Log out' %}</a>{% endblock %}
{% block title %}{{ group.group.name }}{% trans "'s Home" %}{% endblock %}
{% block coltype %}diagram{% endblock %}
{% block extrastyle %}
    <link rel="stylesheet" type="text/css" href="/static/css/group-home.css" />
{% endblock %}
{% block extrahead %}
<script type="text/javascript">
    var config = {
        canvas_id	        : 'discsvu',
        data_url	        : '/get_discussions_view_json/{{ group.slug }}'
    }
    var VUC = new VUController(config);
    VUC.init();

	$(function() {
		$("#mission_statement_dialog").dialog({
			bgiframe: true,
            autoOpen: false,
			height: 402,
			width: 787,
			modal: true,
			buttons: {
				Create: function() {
					$("#mission_statement_form").submit();
				},

				Cancel: function() {
					$(this).dialog('close');
				}
			},
			close: function() {
				window.location = window.location;
			}
		});

		$('#add_mission').click(function() {
			$('#mission_statement_dialog').dialog('open');
		})
	});
</script>

{% if show_errors_in_mission_statement_form %}
	<script>
		$(document).ready(function() {
			$('#mission_statement_dialog').dialog('open');
		});
	</script>
{% endif %}
{% endblock %}
{% block content %}
<div id="buttons_container">
<div id="create_container" {% if not user_in_group %}style="display:none"{% endif %}>
	<input id="create" class="ui-button ui-state-default ui-corner-all" type="button" value="{% trans 'Create Discussion' %}"/><br clear="all"/>
</div>
<input type="button" value="{% trans 'Discussions List' %}" onclick="document.location.href='/discussions_list/{{group.slug}}/'"/>
</div>

<h2>
    {{ group.group.name }}{% trans "'s Home" %}
</h2>
{% ifequal user_permission_type 1 %}
	<form action="/group-delete/{{group.pk}}/" method="post">
        <input type="image" onclick="if(confirm('Are you sure you want to delete this group?')) {this.form.submit();} else { return false; }" src="/static/icons/delete.png">Delete group</input>
    </form>
{% endifequal %}

<p>
	<div id="mission_statement_button" {% if user_in_group %}{% ifequal mission_statement "" %}style="display:block"{%else%}style="display:none"{%endifequal%}{%else %}style="display:none"{% endif %}>
		<input id="add_mission" class="ui-button ui-state-default ui-corner-all" type="button" value="{% trans 'Add Mission Statement' %}"/><br clear="all"/>
	</div>
	<div id="mission_statement_edit" {% if user_in_group %}{% ifnotequal mission_statement "" %}style="display:block"{%else%}style="display:none"{%endifnotequal%}{%else %}style="display:none"{% endif %}>
		<div class="edit" id="missionstatement_{{ mission_statement.pk }}">{{ mission_statement.mission_statement }}</div>
	</div>
	<div id="mission_statement" {% if not user_in_group %}{% ifnotequal mission_statement "" %}style="display:block"{%else%}style="display:none"{%endifnotequal%}{%else %}style="display:none"{% endif %}>
		<div>{{ mission_statement.mission_statement }}</div>
	</div>
</p>

<div id="members_container">
<h3>Current members</h3>
{% for member in members %}
	<a href="{{ member.get_absolute_url }}" class="member" title="{{ member.username }}" alt=""><img src="{{ member.get_profile.get_picture_abs_url }}" alt=""/></a>
{% endfor %}
<input type="button" value="{% trans 'Members List' %}" onclick="document.location.href='/members_list/{{group.slug}}/'"/>
</div>
<!--
<p>
<div id="ms">
{% ifequal mission_statement "" %}
	<div id="mission_statement_button" {% if user_in_group %}style="display:block"{% else %}style="display:none"{% endif %}>
		<input id="add_mission" class="ui-button ui-state-default ui-corner-all" type="button" value="{% trans 'Add Mission Statement' %}"/><br clear="all"/>
	</div>
{% else %}
	{% if user_in_group %}
		<div class="edit" id="missionstatement_{{ mission_statement.pk }}">{{ mission_statement.mission_statement }}</div>
	{% else %}
		<div>{{ mission_statement.mission_statement }}</div>
	{% endif %}
{% endifequal %}
</div>
</p>
-->

<hr/>

<h3>Featured Discussions</h3>
<div id="canvasContainer"></div>

<div id="create_dialog" style="display:none" title="Create new Discussion">
	<form method="POST" action="" id="create_form">
		{{ discussion_form.as_p }}
	</form>
</div>

<div id="mission_statement_dialog" style="display:none" title="Mission Statement">
	<form method="POST" action="" id="mission_statement_form">
		{{ mission_statement_form.as_p }}
	</form>
</div>

<hr/>

{% endblock content %}